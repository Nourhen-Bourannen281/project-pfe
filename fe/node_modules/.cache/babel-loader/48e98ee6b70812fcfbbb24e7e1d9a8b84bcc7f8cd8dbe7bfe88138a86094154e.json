{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { BarcodeFormat, BrowserMultiFormatReader, DecodeHintType } from \"@zxing/library\";\nimport Webcam from \"react-webcam\";\nexport const BarcodeScanner = ({\n  onUpdate,\n  onError,\n  width = \"100%\",\n  height = \"100%\",\n  facingMode = \"environment\",\n  torch,\n  delay = 500,\n  videoConstraints,\n  stopStream,\n  formats\n}) => {\n  const webcamRef = useRef(null);\n  const capture = useCallback(() => {\n    const codeReader = new BrowserMultiFormatReader(new Map([[DecodeHintType.POSSIBLE_FORMATS, formats?.map(f => typeof f === \"string\" ? BarcodeFormat[f] : f)]]));\n    const imageSrc = webcamRef?.current?.getScreenshot();\n    if (imageSrc) {\n      codeReader.decodeFromImage(undefined, imageSrc).then(result => {\n        onUpdate(null, result);\n      }).catch(err => {\n        onUpdate(err);\n      });\n    }\n  }, [onUpdate, formats]);\n  useEffect(() => {\n    // Turn on the flashlight if prop is defined and device has the capability\n    if (typeof torch === \"boolean\" && (navigator?.mediaDevices?.getSupportedConstraints()).torch) {\n      const stream = webcamRef?.current?.video?.srcObject;\n      const track = stream?.getVideoTracks()[0]; // get the active track of the stream\n      if (track && track.getCapabilities().torch) {\n        track.applyConstraints({\n          advanced: [{\n            torch\n          }]\n        }).catch(err => onUpdate(err));\n      }\n    }\n  }, [torch, onUpdate]);\n  useEffect(() => {\n    if (stopStream) {\n      let stream = webcamRef?.current?.video?.srcObject;\n      if (stream) {\n        stream.getTracks().forEach(track => {\n          stream?.removeTrack(track);\n          track.stop();\n        });\n        stream = null;\n      }\n    }\n  }, [stopStream]);\n  useEffect(() => {\n    const interval = setInterval(capture, delay);\n    return () => {\n      clearInterval(interval);\n    };\n  }, [capture, delay]);\n  return _jsx(Webcam, {\n    width: width,\n    height: height,\n    ref: webcamRef,\n    screenshotFormat: \"image/jpeg\",\n    videoConstraints: videoConstraints || {\n      facingMode\n    },\n    audio: false,\n    onUserMediaError: onError,\n    \"data-testid\": \"video\"\n  });\n};\nexport default BarcodeScanner;","map":{"version":3,"names":["jsx","_jsx","useCallback","useEffect","useRef","BarcodeFormat","BrowserMultiFormatReader","DecodeHintType","Webcam","BarcodeScanner","onUpdate","onError","width","height","facingMode","torch","delay","videoConstraints","stopStream","formats","webcamRef","capture","codeReader","Map","POSSIBLE_FORMATS","map","f","imageSrc","current","getScreenshot","decodeFromImage","undefined","then","result","catch","err","navigator","mediaDevices","getSupportedConstraints","stream","video","srcObject","track","getVideoTracks","getCapabilities","applyConstraints","advanced","getTracks","forEach","removeTrack","stop","interval","setInterval","clearInterval","ref","screenshotFormat","audio","onUserMediaError"],"sources":["D:/projet-pfe/fe/node_modules/react-qr-barcode-scanner/dist/BarcodeScanner.js"],"sourcesContent":["import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { BarcodeFormat, BrowserMultiFormatReader, DecodeHintType, } from \"@zxing/library\";\nimport Webcam from \"react-webcam\";\nexport const BarcodeScanner = ({ onUpdate, onError, width = \"100%\", height = \"100%\", facingMode = \"environment\", torch, delay = 500, videoConstraints, stopStream, formats, }) => {\n    const webcamRef = useRef(null);\n    const capture = useCallback(() => {\n        const codeReader = new BrowserMultiFormatReader(new Map([\n            [\n                DecodeHintType.POSSIBLE_FORMATS,\n                formats?.map((f) => (typeof f === \"string\" ? BarcodeFormat[f] : f)),\n            ],\n        ]));\n        const imageSrc = webcamRef?.current?.getScreenshot();\n        if (imageSrc) {\n            codeReader\n                .decodeFromImage(undefined, imageSrc)\n                .then((result) => {\n                onUpdate(null, result);\n            })\n                .catch((err) => {\n                onUpdate(err);\n            });\n        }\n    }, [onUpdate, formats]);\n    useEffect(() => {\n        // Turn on the flashlight if prop is defined and device has the capability\n        if (typeof torch === \"boolean\" &&\n            (navigator?.mediaDevices?.getSupportedConstraints()).torch) {\n            const stream = webcamRef?.current?.video?.srcObject;\n            const track = stream?.getVideoTracks()[0]; // get the active track of the stream\n            if (track && track.getCapabilities().torch) {\n                track\n                    .applyConstraints({\n                    advanced: [{ torch }],\n                })\n                    .catch((err) => onUpdate(err));\n            }\n        }\n    }, [torch, onUpdate]);\n    useEffect(() => {\n        if (stopStream) {\n            let stream = webcamRef?.current?.video?.srcObject;\n            if (stream) {\n                stream.getTracks().forEach((track) => {\n                    stream?.removeTrack(track);\n                    track.stop();\n                });\n                stream = null;\n            }\n        }\n    }, [stopStream]);\n    useEffect(() => {\n        const interval = setInterval(capture, delay);\n        return () => {\n            clearInterval(interval);\n        };\n    }, [capture, delay]);\n    return (_jsx(Webcam, { width: width, height: height, ref: webcamRef, screenshotFormat: \"image/jpeg\", videoConstraints: videoConstraints || {\n            facingMode,\n        }, audio: false, onUserMediaError: onError, \"data-testid\": \"video\" }));\n};\nexport default BarcodeScanner;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}